var util = require('util');
var fs = require('fs');
var _ = require('lodash');

// uniq_pairs is a list of unique event strings
var uniq_pairs = [];
var trainingSet = {};

var traces = {
  'hexacopter-hil-clean-01.kev.csv' : 'clean',
  'hexacopter-hil-clean-02.kev.csv' : 'clean',
  'hexacopter-hil-clean-03.kev.csv' : 'clean',
  'hexacopter-hil-clean-04.kev.csv' : 'clean',
  'hexacopter-hil-clean-05.kev.csv' : 'clean',
  'hexacopter-hil-clean-06.kev.csv' : 'clean',
  'hexacopter-hil-clean-07.kev.csv' : 'clean',
  'hexacopter-hil-clean-08.kev.csv' : 'clean',
  'hexacopter-hil-clean-09.kev.csv' : 'clean',
  // 'hexacopter-hil-fifo-ls-01.kev.csv' : 'anomaly',
  // 'hexacopter-hil-fifo-ls-sporadic.kev.csv' : 'anomaly',
  // 'hexacopter-hil-full-while.kev.csv' : 'anomaly',
  // 'hexacopter-hil-half-while.kev.csv' : 'anomaly',
  'hexacopter-hil-fifo-ls-02.kev.csv' : 'anomaly',
  'hexacopter-hil-clean-10.kev.csv' : 'clean'
};

var runNet = function () {
  console.log(trainingSet);

  var targetTrace = 'hexacopter-hil-clean-10.kev.csv';
  var netInput = trainingSet[targetTrace];
  delete trainingSet[targetTrace];

  // Create a SOM of four (width X height) nodes.
  // It will expect traces.length items to be submitted for training.
  var som = require('som').create({
    features: uniq_pairs,
    iterationCount: _.size(traces),
    width: 1,
    height: 2
  });

  //initialize SOM with default distance function (euclidean)
  som.init({});

  //begin training SOM
  _.forEach(trainingSet, function (val, key) {
    console.log("Trace: " + key);
    console.log("Class of the trace: " + traces[key]);
    som.train(key, val);
  });

  console.log('SOM', util.inspect(som, false, 8));

  console.log('best matching unit for', targetTrace);
  var result = som.bestMatchingUnit(netInput);
  console.log(util.inspect(result, false, 8));
};

(function () {
  var readFromDisk = false;
  if (readFromDisk) {
    var cb = _.after(_.size(traces), function () {
      runNet();
    });

    _.forEach(traces, function (tclass, trace) {
      fs.readFile(trace, {encoding: 'utf8'}, function (err, data) {
        if (err) throw err;
        var stats = {};

        var lines = data.split('\n');
        lines.splice(0, 1);
        lines.splice(lines.length - 1);
        var eventCount = lines.length;

        var events = lines.map(function (line) {
          var token = line.split(',')[4];
          // var event_token = line.split(',')[4];
          // var pname_token = line.split(',')[28];

          // event_token = event_token.substring(1, event_token.length - 1);
          // pname_token = pname_token.substring(1, pname_token.length - 1);

          token = token.substring(1, token.length - 1);
          // var token = event_token + '-' + pname_token;

          if (_.indexOf(uniq_pairs, token) < 0) uniq_pairs.push(token);
          return token;
        });

        uniq_pairs.forEach(function (targetEv) {
          var foundTargets = events.filter(function (ev) {
            return ev === targetEv;
          });
          // console.log(foundTargets.length);
          stats[targetEv] = foundTargets.length;
        });

        trainingSet[trace] = stats; // the inputs are relative event counts
        cb();
      });
    });
  } else {
    trainingSet = {
      'hexacopter-hil-clean-01.kev.csv': { BUFFER: 2161, TIME: 2161, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 48232, THRECEIVE: 42120, THSIGWAITINFO: 91, PROCTHREAD_NAME: 21, THNANOSLEEP: 1653, THREPLY: 17956, THRUNNING: 85342, THCONDVAR: 2162, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 36005, SND_MESSAGE: 18089, REC_MESSAGE: 17968, 'MSG_RECEIVEV/14': 85339, 'MSG_REPLYV/15': 35916, REPLY_MESSAGE: 17947, REC_PULSE: 24710, '0x00000044': 90012, SND_PULSE_EXE: 36701, 'EVENT-2': 24008, '0x00000029': 1104, 'EVENT-0': 3001, 'CONNECT_CLIENT_INFO/42': 18038, 'SYNC_CONDVAR_SIGNAL/83': 2162, 'SYNC_CONDVAR_SIG/83': 2163, 'SYNC_CONDVAR_WAIT/82': 4338, 'MSG_READV/16': 14989, THWAITPAGE: 1822, '0x0000002d': 14228, 'MSG_WRITEV/17': 7531, 'TIMER_TIMEOUT/75': 3300, 'SIGNAL_WAITINFO/32': 169, 'EVENT-1': 1500, '0x00000049': 6000, 'MSG_INFO/19': 2618, 'MSG_CURRENT/10': 2618, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 168, 'MSG_SENDVNC/12': 192, THSEND: 28, 'MSG_ERROR/13': 12, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 324, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 329, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 2, THMUTEX: 1, 'SYNC_MUTEX_UNLOCK/81': 2 },
  'hexacopter-hil-clean-03.kev.csv': { BUFFER: 2170, TIME: 2170, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 47709, THRECEIVE: 41522, THSIGWAITINFO: 95, PROCTHREAD_NAME: 21, THNANOSLEEP: 1650, THREPLY: 17949, THRUNNING: 83639, THCONDVAR: 2171, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 35997, SND_MESSAGE: 18073, REC_MESSAGE: 17963, 'MSG_RECEIVEV/14': 84244, 'MSG_REPLYV/15': 35909, REPLY_MESSAGE: 17938, REC_PULSE: 24173, '0x00000044': 90000, SND_PULSE_EXE: 60157, 'EVENT-2': 24004, '0x00000029': 1112, 'EVENT-0': 3000, 'CONNECT_CLIENT_INFO/42': 17966, 'SYNC_CONDVAR_SIGNAL/83': 2169, 'SYNC_CONDVAR_SIG/83': 2171, 'SYNC_CONDVAR_WAIT/82': 4351, 'MSG_READV/16': 15021, THWAITPAGE: 1833, '0x0000002d': 12000, 'MSG_WRITEV/17': 7489, 'TIMER_TIMEOUT/75': 3298, 'SIGNAL_WAITINFO/32': 171, 'EVENT-1': 1500, '0x00000049': 6000, 'MSG_INFO/19': 2588, 'MSG_CURRENT/10': 2588, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 168, 'MSG_SENDVNC/12': 172, THSEND: 19, 'MSG_ERROR/13': 16, MSG_ERROR: 8, 'CONNECT_ATTACH/39': 332, PATHMGR_OPEN: 79, 'CONNECT_DETACH/40': 334, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 0, THMUTEX: 0, 'SYNC_MUTEX_UNLOCK/81': 0, SIGNAL: 2, 'SIGNAL_RETURN/27': 4, 'TIMER_ALARM/74': 4, 'KER_SIGNAL_WAITINFO/32': 1 },
  'hexacopter-hil-clean-02.kev.csv': { BUFFER: 2158, TIME: 2158, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 47779, THRECEIVE: 41577, THSIGWAITINFO: 94, PROCTHREAD_NAME: 21, THNANOSLEEP: 1657, THREPLY: 17959, THRUNNING: 84025, THCONDVAR: 2159, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 35985, SND_MESSAGE: 18077, REC_MESSAGE: 17969, 'MSG_RECEIVEV/14': 84385, 'MSG_REPLYV/15': 35927, REPLY_MESSAGE: 17950, REC_PULSE: 24226, '0x00000044': 90012, SND_PULSE_EXE: 48219, 'EVENT-2': 24008, '0x00000029': 1100, 'EVENT-0': 3002, 'CONNECT_CLIENT_INFO/42': 18013, 'SYNC_CONDVAR_SIGNAL/83': 2161, 'SYNC_CONDVAR_SIG/83': 2163, 'SYNC_CONDVAR_WAIT/82': 4319, 'MSG_READV/16': 14956, THWAITPAGE: 1821, '0x0000002d': 12296, 'MSG_WRITEV/17': 7518, 'TIMER_TIMEOUT/75': 3312, 'SIGNAL_WAITINFO/32': 174, 'EVENT-1': 1501, '0x00000049': 6000, 'MSG_INFO/19': 2600, 'MSG_CURRENT/10': 2600, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 172, 'MSG_SENDVNC/12': 193, THSEND: 38, 'MSG_ERROR/13': 12, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 324, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 324, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 2, THMUTEX: 1, 'SYNC_MUTEX_UNLOCK/81': 2, SIGNAL: 1, 'SIGNAL_RETURN/27': 2, 'TIMER_ALARM/74': 2, 'KER_SIGNAL_WAITINFO/32': 0 },
  'hexacopter-hil-clean-04.kev.csv': { BUFFER: 2224, TIME: 2224, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 48497, THRECEIVE: 42216, THSIGWAITINFO: 92, PROCTHREAD_NAME: 21, THNANOSLEEP: 1652, THREPLY: 18106, THRUNNING: 85259, THCONDVAR: 2225, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 36317, SND_MESSAGE: 18234, REC_MESSAGE: 18135, 'MSG_RECEIVEV/14': 85955, 'MSG_REPLYV/15': 36235, REPLY_MESSAGE: 18098, REC_PULSE: 24871, '0x00000044': 90006, SND_PULSE_EXE: 72854, 'EVENT-2': 24010, '0x00000029': 1092, 'EVENT-0': 3002, 'CONNECT_CLIENT_INFO/42': 18206, 'SYNC_CONDVAR_SIGNAL/83': 2224, 'SYNC_CONDVAR_SIG/83': 2224, 'SYNC_CONDVAR_WAIT/82': 4468, 'MSG_READV/16': 15574, THWAITPAGE: 1879, '0x0000002d': 14348, 'MSG_WRITEV/17': 7578, 'TIMER_TIMEOUT/75': 3299, 'SIGNAL_WAITINFO/32': 170, 'EVENT-1': 1501, '0x00000049': 6004, 'MSG_INFO/19': 2710, 'MSG_CURRENT/10': 2711, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 168, 'MSG_SENDVNC/12': 168, THSEND: 36, 'MSG_ERROR/13': 12, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 327, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 324, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 0, THMUTEX: 0, 'SYNC_MUTEX_UNLOCK/81': 0, SIGNAL: 0, 'SIGNAL_RETURN/27': 0, 'TIMER_ALARM/74': 0, 'KER_SIGNAL_WAITINFO/32': 0 },
  'hexacopter-hil-clean-06.kev.csv': { BUFFER: 2243, TIME: 2242, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 48121, THRECEIVE: 41840, THSIGWAITINFO: 93, PROCTHREAD_NAME: 21, THNANOSLEEP: 1651, THREPLY: 18140, THRUNNING: 85552, THCONDVAR: 2245, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 36329, SND_MESSAGE: 18247, REC_MESSAGE: 18147, 'MSG_RECEIVEV/14': 84986, 'MSG_REPLYV/15': 36299, REPLY_MESSAGE: 18131, REC_PULSE: 24358, '0x00000044': 89982, SND_PULSE_EXE: 96321, 'EVENT-2': 24002, '0x00000029': 1264, 'EVENT-0': 3000, 'CONNECT_CLIENT_INFO/42': 18164, 'SYNC_CONDVAR_SIGNAL/83': 2249, 'SYNC_CONDVAR_SIG/83': 2255, 'SYNC_CONDVAR_WAIT/82': 4501, 'MSG_READV/16': 15635, THWAITPAGE: 1894, '0x0000002d': 12024, 'MSG_WRITEV/17': 7557, 'TIMER_TIMEOUT/75': 3298, 'SIGNAL_WAITINFO/32': 172, 'EVENT-1': 1500, '0x00000049': 6000, 'MSG_INFO/19': 2706, 'MSG_CURRENT/10': 2706, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 170, 'MSG_SENDVNC/12': 192, THSEND: 28, 'MSG_ERROR/13': 12, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 326, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 325, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 8, THMUTEX: 5, 'SYNC_MUTEX_UNLOCK/81': 10, SIGNAL: 1, 'SIGNAL_RETURN/27': 2, 'TIMER_ALARM/74': 2, 'KER_SIGNAL_WAITINFO/32': 0 },
  'hexacopter-hil-clean-05.kev.csv': { BUFFER: 2242, TIME: 2243, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 48925, THRECEIVE: 42265, THSIGWAITINFO: 92, PROCTHREAD_NAME: 21, THNANOSLEEP: 1651, THREPLY: 18112, THRUNNING: 86047, THCONDVAR: 2243, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 36307, SND_MESSAGE: 18235, REC_MESSAGE: 18134, 'MSG_RECEIVEV/14': 85902, 'MSG_REPLYV/15': 36238, REPLY_MESSAGE: 18103, REC_PULSE: 24849, '0x00000044': 89976, SND_PULSE_EXE: 84809, 'EVENT-2': 23998, '0x00000029': 1028, 'EVENT-0': 3000, 'CONNECT_CLIENT_INFO/42': 18044, 'SYNC_CONDVAR_SIGNAL/83': 2243, 'SYNC_CONDVAR_SIG/83': 2243, 'SYNC_CONDVAR_WAIT/82': 4502, 'MSG_READV/16': 15666, THWAITPAGE: 1894, '0x0000002d': 14188, 'MSG_WRITEV/17': 7489, 'TIMER_TIMEOUT/75': 3297, 'SIGNAL_WAITINFO/32': 175, 'EVENT-1': 1500, '0x00000049': 6000, 'MSG_INFO/19': 2650, 'MSG_CURRENT/10': 2650, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 171, 'MSG_SENDVNC/12': 192, THSEND: 31, 'MSG_ERROR/13': 13, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 324, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 324, 'CONNECT_FLAGS/43': 151, 'SYNC_MUTEX_LOCK/80': 2, THMUTEX: 1, 'SYNC_MUTEX_UNLOCK/81': 2, SIGNAL: 0, 'SIGNAL_RETURN/27': 0, 'TIMER_ALARM/74': 0, 'KER_SIGNAL_WAITINFO/32': 0 },
  'hexacopter-hil-clean-07.kev.csv': { BUFFER: 2264, TIME: 2264, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 48732, THRECEIVE: 41947, THSIGWAITINFO: 94, PROCTHREAD_NAME: 21, THNANOSLEEP: 1650, THREPLY: 18199, THRUNNING: 84897, THCONDVAR: 2265, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 36435, SND_MESSAGE: 18300, REC_MESSAGE: 18216, 'MSG_RECEIVEV/14': 85168, 'MSG_REPLYV/15': 36412, REPLY_MESSAGE: 18190, REC_PULSE: 24390, '0x00000044': 89970, SND_PULSE_EXE: 108339, 'EVENT-2': 24000, '0x00000029': 1272, 'EVENT-0': 3000, 'CONNECT_CLIENT_INFO/42': 18222, 'SYNC_CONDVAR_SIGNAL/83': 2264, 'SYNC_CONDVAR_SIG/83': 2266, 'SYNC_CONDVAR_WAIT/82': 4541, 'MSG_READV/16': 15825, THWAITPAGE: 1912, '0x0000002d': 12000, 'MSG_WRITEV/17': 7558, 'TIMER_TIMEOUT/75': 3295, 'SIGNAL_WAITINFO/32': 173, 'EVENT-1': 1500, '0x00000049': 6000, 'MSG_INFO/19': 2752, 'MSG_CURRENT/10': 2752, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 170, 'MSG_SENDVNC/12': 192, THSEND: 41, 'MSG_ERROR/13': 12, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 324, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 328, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 0, THMUTEX: 0, 'SYNC_MUTEX_UNLOCK/81': 0, SIGNAL: 0, 'SIGNAL_RETURN/27': 0, 'TIMER_ALARM/74': 0, 'KER_SIGNAL_WAITINFO/32': 0 },
  'hexacopter-hil-clean-08.kev.csv': { BUFFER: 2278, TIME: 2278, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 48689, THRECEIVE: 41734, THSIGWAITINFO: 94, PROCTHREAD_NAME: 21, THNANOSLEEP: 1651, THREPLY: 18188, THRUNNING: 85305, THCONDVAR: 2279, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 36430, SND_MESSAGE: 18286, REC_MESSAGE: 18213, 'MSG_RECEIVEV/14': 85158, 'MSG_REPLYV/15': 36392, REPLY_MESSAGE: 18180, REC_PULSE: 24397, '0x00000044': 90000, SND_PULSE_EXE: 120360, 'EVENT-2': 24008, '0x00000029': 1076, 'EVENT-0': 3000, 'CONNECT_CLIENT_INFO/42': 18105, 'SYNC_CONDVAR_SIGNAL/83': 2284, 'SYNC_CONDVAR_SIG/83': 2286, 'SYNC_CONDVAR_WAIT/82': 4573, 'MSG_READV/16': 15773, THWAITPAGE: 1928, '0x0000002d': 12000, 'MSG_WRITEV/17': 7522, 'TIMER_TIMEOUT/75': 3297, 'SIGNAL_WAITINFO/32': 172, 'EVENT-1': 1500, '0x00000049': 6000, 'MSG_INFO/19': 2676, 'MSG_CURRENT/10': 2676, 'EVENT-3': 1501, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 170, 'MSG_SENDVNC/12': 168, THSEND: 17, 'MSG_ERROR/13': 12, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 324, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 326, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 2, THMUTEX: 1, 'SYNC_MUTEX_UNLOCK/81': 2, SIGNAL: 1, 'SIGNAL_RETURN/27': 2, 'TIMER_ALARM/74': 2, 'KER_SIGNAL_WAITINFO/32': 0 },
  'hexacopter-hil-clean-09.kev.csv': { BUFFER: 2298, TIME: 2298, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 48241, THRECEIVE: 41786, THSIGWAITINFO: 93, PROCTHREAD_NAME: 21, THNANOSLEEP: 1651, THREPLY: 18258, THRUNNING: 84984, THCONDVAR: 2299, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 36575, SND_MESSAGE: 18373, REC_MESSAGE: 18260, 'MSG_RECEIVEV/14': 85369, 'MSG_REPLYV/15': 36513, REPLY_MESSAGE: 18248, REC_PULSE: 24442, '0x00000044': 89982, SND_PULSE_EXE: 132390, 'EVENT-2': 24002, '0x00000029': 1192, 'EVENT-0': 3000, 'CONNECT_CLIENT_INFO/42': 18132, 'SYNC_CONDVAR_SIGNAL/83': 2297, 'SYNC_CONDVAR_SIG/83': 2297, 'SYNC_CONDVAR_WAIT/82': 4606, 'MSG_READV/16': 15934, THWAITPAGE: 1943, '0x0000002d': 12000, 'MSG_WRITEV/17': 7574, 'TIMER_TIMEOUT/75': 3298, 'SIGNAL_WAITINFO/32': 171, 'EVENT-1': 1500, '0x00000049': 6000, 'MSG_INFO/19': 2680, 'MSG_CURRENT/10': 2680, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 170, 'MSG_SENDVNC/12': 192, THSEND: 32, 'MSG_ERROR/13': 12, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 325, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 327, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 2, THMUTEX: 1, 'SYNC_MUTEX_UNLOCK/81': 2, SIGNAL: 1, 'SIGNAL_RETURN/27': 2, 'TIMER_ALARM/74': 2, 'KER_SIGNAL_WAITINFO/32': 0 },
  'hexacopter-hil-fifo-ls-02.kev.csv': { BUFFER: 4938, TIME: 4937, PROCCREATE_NAME: 77, THCREATE: 186, THREADY: 95913, THRECEIVE: 84126, THSIGWAITINFO: 67, PROCTHREAD_NAME: 22, THNANOSLEEP: 3358, THREPLY: 66934, THRUNNING: 173486, THCONDVAR: 2804, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 89306, SND_MESSAGE: 67122, REC_MESSAGE: 66973, 'MSG_RECEIVEV/14': 190571, 'MSG_REPLYV/15': 122762, REPLY_MESSAGE: 61336, REC_PULSE: 28349, '0x00000044': 89250, SND_PULSE_EXE: 193406, 'EVENT-2': 23956, '0x00000029': 1700, 'EVENT-0': 2173, 'CONNECT_CLIENT_INFO/42': 27426, 'SYNC_CONDVAR_SIGNAL/83': 4842, 'SYNC_CONDVAR_SIG/83': 4846, 'SYNC_CONDVAR_WAIT/82': 5628, 'MSG_READV/16': 22411, THWAITPAGE: 2421, '0x0000002d': 9732, 'MSG_WRITEV/17': 7961, 'TIMER_TIMEOUT/75': 6944, 'SIGNAL_WAITINFO/32': 138, 'EVENT-1': 1086, '0x00000049': 5952, 'MSG_INFO/19': 1988, 'MSG_CURRENT/10': 1876, 'EVENT-3': 1098, '0x0000002e': 2272, 'MSG_DELIVER_EVENT/21': 135, 'MSG_SENDVNC/12': 44971, THSEND: 781, 'MSG_ERROR/13': 11183, MSG_ERROR: 5589, 'CONNECT_ATTACH/39': 34194, PATHMGR_OPEN: 6567, 'CONNECT_DETACH/40': 36021, 'CONNECT_FLAGS/43': 980, 'SYNC_MUTEX_LOCK/80': 684, THMUTEX: 194, 'SYNC_MUTEX_UNLOCK/81': 388, SIGNAL: 36, 'SIGNAL_RETURN/27': 72, 'TIMER_ALARM/74': 24, 'KER_SIGNAL_WAITINFO/32': 6, THSIGSUSPEND: 25, 'TIMER_SETTIME/72': 158, 'MSG_SEND_PULSE/20': 1772, SND_PULSE: 884, '0x00000040': 84, 'INTERRUPT_UNMASK/60': 42, 'THREAD_DESTROY/47': 60, 'THREAD_DESTROYALL/48': 117, THDESTROY: 117, THDEAD: 117, 'THREAD_CREATE/46': 224, THWAITTHREAD: 112, 'SIGNAL_ACTION/29': 9952, 'SIGNAL_PROCMASK/30': 828, 'CONNECT_SERVER_INFO/41': 590, SND_PULSE_DIS: 880, MUNMAP: 361, 'KER_SIGNAL_SUSPEND/31': 30, PROCDESTROY: 56, PROCCREATE: 54, 'SCHED_GET/88': 972, 'KER_MSG_SENDV/11': 50, 'SYNC_CREATE/78': 720, 'SIGNAL_SUSPEND/31': 24, 'THREAD_CTL/52': 60, MMAP: 561, MAPNAME: 60, 'SCHED_SET/89': 50, 'SYS_CPUPAGE_GET/07': 372, 'SYS_CPUPAGE_SET/08': 52, 'SYNC_DESTROY/79': 36, '0x00000013': 48, 'MSG_RECEIVEPULSEV/24': 23 },
  'hexacopter-hil-clean-10.kev.csv': { BUFFER: 2329, TIME: 2329, PROCCREATE_NAME: 25, THCREATE: 68, THREADY: 48742, THRECEIVE: 42214, THSIGWAITINFO: 94, PROCTHREAD_NAME: 21, THNANOSLEEP: 1651, THREPLY: 18338, THRUNNING: 85473, THCONDVAR: 2330, THJOIN: 1, 'TRACE_EVENT/01': 1, 'MSG_SENDV/11': 36719, SND_MESSAGE: 18447, REC_MESSAGE: 18347, 'MSG_RECEIVEV/14': 85957, 'MSG_REPLYV/15': 36670, REPLY_MESSAGE: 18329, REC_PULSE: 24644, '0x00000044': 89964, SND_PULSE_EXE: 144575, 'EVENT-2': 23998, '0x00000029': 1048, 'EVENT-0': 3000, 'CONNECT_CLIENT_INFO/42': 18258, 'SYNC_CONDVAR_SIGNAL/83': 2333, 'SYNC_CONDVAR_SIG/83': 2336, 'SYNC_CONDVAR_WAIT/82': 4675, 'MSG_READV/16': 16152, THWAITPAGE: 1969, '0x0000002d': 12768, 'MSG_WRITEV/17': 7590, 'TIMER_TIMEOUT/75': 3308, 'SIGNAL_WAITINFO/32': 171, 'EVENT-1': 1500, '0x00000049': 6000, 'MSG_INFO/19': 2768, 'MSG_CURRENT/10': 2768, 'EVENT-3': 1500, '0x0000002e': 3000, 'MSG_DELIVER_EVENT/21': 168, 'MSG_SENDVNC/12': 192, THSEND: 28, 'MSG_ERROR/13': 12, MSG_ERROR: 6, 'CONNECT_ATTACH/39': 324, PATHMGR_OPEN: 78, 'CONNECT_DETACH/40': 324, 'CONNECT_FLAGS/43': 150, 'SYNC_MUTEX_LOCK/80': 4, THMUTEX: 2, 'SYNC_MUTEX_UNLOCK/81': 4, SIGNAL: 2, 'SIGNAL_RETURN/27': 4, 'TIMER_ALARM/74': 4, 'KER_SIGNAL_WAITINFO/32': 1, THSIGSUSPEND: 0, 'TIMER_SETTIME/72': 0, 'MSG_SEND_PULSE/20': 0, SND_PULSE: 0, '0x00000040': 0, 'INTERRUPT_UNMASK/60': 0, 'THREAD_DESTROY/47': 0, 'THREAD_DESTROYALL/48': 0, THDESTROY: 0, THDEAD: 0, 'THREAD_CREATE/46': 0, THWAITTHREAD: 0, 'SIGNAL_ACTION/29': 0, 'SIGNAL_PROCMASK/30': 0, 'CONNECT_SERVER_INFO/41': 0, SND_PULSE_DIS: 0, MUNMAP: 0, 'KER_SIGNAL_SUSPEND/31': 0, PROCDESTROY: 0, PROCCREATE: 0, 'SCHED_GET/88': 0, 'KER_MSG_SENDV/11': 0, 'SYNC_CREATE/78': 0, 'SIGNAL_SUSPEND/31': 0, 'THREAD_CTL/52': 0, MMAP: 0, MAPNAME: 0, 'SCHED_SET/89': 0, 'SYS_CPUPAGE_GET/07': 0, 'SYS_CPUPAGE_SET/08': 0, 'SYNC_DESTROY/79': 0, '0x00000013': 0, 'MSG_RECEIVEPULSEV/24': 0 }
    };
    uniq_pairs = _.keys(trainingSet[_.keys(trainingSet)[0]]);
    runNet();
  }
})();

// fs.readFile('eventData.json', 'utf8', function (err, data) {
//   if (err) throw err;
//   trainingSet = JSON.parse(data);
//   _.forEach(trainingSet, function (evCntDict) {
//     _.forEach(evCntDict, function (cnt, ev) {
//       if (_.indexOf(uniq_pairs, ev) < 0) uniq_pairs.push(ev);
//     });
//   });

//   runNet();
// });
