var fs = require('fs');
var brain = require('brain'),
    _ = require('lodash');


var runNetwork = function (trainingInputs, input) {
  var net = new brain.NeuralNetwork();

  var outputs = [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1];

  var trainingSet = trainingInputs.map(function (input, i) {
    return {input: input, output: [outputs[i]]};
  });

  console.log(trainingSet);

  var trainingRes = net.train(trainingSet);

  console.log('training complete. results:', trainingRes);
  if (trainingRes.error > 0.1 && trainingRes.iterations > 10000) {
    console.log('training went wrong. The data might be too noisy');
  }

  var output = net.run(input);

  console.log(output);
};

var runFromFiles = function () {
  var traces = [
    'hexacopter-hil-clean-01.kev.csv',
    'hexacopter-hil-clean-02.kev.csv',
    'hexacopter-hil-clean-03.kev.csv',
    'hexacopter-hil-clean-04.kev.csv',
    'hexacopter-hil-clean-05.kev.csv',
    'hexacopter-hil-clean-06.kev.csv',
    'hexacopter-hil-clean-07.kev.csv',
    'hexacopter-hil-clean-08.kev.csv',
    'hexacopter-hil-clean-10.kev.csv',
    'hexacopter-hil-fifo-ls-02.kev.csv',
    'hexacopter-hil-full-while.kev.csv',
    'hexacopter-hil-fifo-ls-01.kev.csv',
    'hexacopter-hil-fifo-ls-sporadic.kev.csv',
    'hexacopter-hil-half-while.kev.csv'
    //'hexacopter-hil-clean-09.kev.csv'
  ];

  var trainingSet = {};
  var cb = _.after(traces.length, function () {
    orderedTrainingSet = [];
    traces.forEach(function (name) {
      orderedTrainingSet.push(trainingSet[name]);
    });
    // use the last trace as input (not for training);
    var input = orderedTrainingSet.splice(orderedTrainingSet.length - 1)[0];
    console.log('training inputs', orderedTrainingSet, 'input:', input);
    runNetwork(orderedTrainingSet, input);
  });

  traces.forEach(function (trace) {
    fs.readFile(trace, {encoding: 'utf8'}, function (err, data) {
      if (err) throw err;

      var stats = {};
      var targetEvs = ["BUFFER", "TIME", "PROCCREATE_NAME",
                       "THCREATE", "THREADY", "THRECEIVE", "THSIGWAITINFO", "PROCTHREAD_NAME",
                       "THNANOSLEEP", "THREPLY", "THRUNNING", "THCONDVAR", "THJOIN", "TRACE_EVENT/01", "MSG_SENDV/11",
                        "SND_MESSAGE", "REC_MESSAGE", "MSG_RECEIVEV/14",
                        "MSG_REPLYV/15","REPLY_MESSAGE","REC_PULSE", "SND_PULSE_EXE","EVENT-2",
                        "EVENT-0","CONNECT_CLIENT_INFO/42",
                        "SYNC_CONDVAR_SIGNAL/83","SYNC_CONDVAR_SIG/83","SYNC_CONDVAR_WAIT/82",
                        "MSG_READV/16","THWAITPAGE",
                        "MSG_WRITEV/17","TIMER_TIMEOUT/75","SIGNAL_WAITINFO/32",
                        "EVENT-1","MSG_INFO/19",
                        "MSG_CURRENT/10","EVENT-3",
                        "MSG_DELIVER_EVENT/21","MSG_SENDVNC/12","THSEND",
                        "MSG_ERROR/13","MSG_ERROR","CONNECT_ATTACH/39",
                        "PATHMGR_OPEN","CONNECT_DETACH/40","CONNECT_FLAGS/43",
                        "SYNC_MUTEX_LOCK/80","THMUTEX","SYNC_MUTEX_UNLOCK/81"];


      var lines = data.split('\n');
      lines.splice(0, 1);
      lines.splice(lines.length - 1);
      var eventCount = lines.length;

      var events = lines.map(function (line) {
        var token = line.split(',')[4];
        return token.substring(1, token.length - 1);
      });

      targetEvs.forEach(function (targetEv) {
        var foundTargets = events.filter(function (ev) {
          return ev === targetEv;
        });
        stats[targetEv] = foundTargets.length / eventCount;
      });

      trainingSet[trace] = stats;
      cb();
    });
  });
};

var runFromMemory = function () {
  var traces = [
    'hexacopter-hil-clean-01.kev.csv',
    'hexacopter-hil-clean-02.kev.csv',
    'hexacopter-hil-clean-03.kev.csv',
    'hexacopter-hil-clean-04.kev.csv',
    'hexacopter-hil-clean-05.kev.csv',
    'hexacopter-hil-clean-06.kev.csv',
    'hexacopter-hil-clean-07.kev.csv',
    'hexacopter-hil-clean-08.kev.csv',
    'hexacopter-hil-clean-10.kev.csv',
    'hexacopter-hil-fifo-ls-01.kev.csv',
    'hexacopter-hil-fifo-ls-sporadic.kev.csv',
    'hexacopter-hil-half-while.kev.csv',
    //'hexacopter-hil-fifo-ls-02.kev.csv',
    'hexacopter-hil-full-while.kev.csv'
    //'hexacopter-hil-clean-09.kev.csv'
  ];

  var trainingInputs = {
    'hexacopter-hil-clean-01.kev.csv': {
        BUFFER: 0.00317765144942667,
        TIME: 0.00317765144942667,
        PROCCREATE_NAME: 0.00003676135411183098,
        THCREATE: 0.00009999088318418027,
        THREADY: 0.07092294526087327,
        THRECEIVE: 0.061935529407612835,
        THSIGWAITINFO: 0.00013381132896706478,
        PROCTHREAD_NAME: 0.000030879537453938024,
        THNANOSLEEP: 0.0024306607338742646,
        THREPLY: 0.026403474977281485,
        THRUNNING: 0.12549149930447517,
        THCONDVAR: 0.0031791219035911433,
        THJOIN: 0.0000014704541644732391,
        'TRACE_EVENT/01': 0.0000014704541644732391,
        'MSG_SENDV/11': 0.052943702191858975,
        SND_MESSAGE: 0.026599045381156424,
        REC_MESSAGE: 0.02642112042725516,
        'MSG_RECEIVEV/14': 0.12548708794198177,
        'MSG_REPLYV/15': 0.05281283177122086,
        REPLY_MESSAGE: 0.026390240889801225,
        REC_PULSE: 0.03633492240413374,
        SND_PULSE_EXE: 0.05396713829033235,
        'EVENT-2': 0.03530266358067353,
        'EVENT-0': 0.004412832947584191,
        'CONNECT_CLIENT_INFO/42': 0.026524052218768288,
        'SYNC_CONDVAR_SIGNAL/83': 0.0031791219035911433,
        'SYNC_CONDVAR_SIG/83': 0.0031805923577556162,
        'SYNC_CONDVAR_WAIT/82': 0.006378830165484912,
        'MSG_READV/16': 0.02204063747128938,
        THWAITPAGE: 0.002679167487670242,
        'MSG_WRITEV/17': 0.011073990312647964,
        'TIMER_TIMEOUT/75': 0.004852498742761689,
        'SIGNAL_WAITINFO/32': 0.0002485067537959774,
        'EVENT-1': 0.002205681246709859,
        'MSG_INFO/19': 0.00384964900259094,
        'MSG_CURRENT/10': 0.00384964900259094,
        'EVENT-3': 0.002205681246709859,
        'MSG_DELIVER_EVENT/21': 0.0002470362996315042,
        'MSG_SENDVNC/12': 0.0002823271995788619,
        THSEND: 0.000041172716605250696,
        'MSG_ERROR/13': 0.00001764544997367887,
        MSG_ERROR: 0.000008822724986839435,
        'CONNECT_ATTACH/39': 0.0004764271492893295,
        PATHMGR_OPEN: 0.00011469542482891266,
        'CONNECT_DETACH/40': 0.0004837794201116957,
        'CONNECT_FLAGS/43': 0.0002205681246709859,
        'SYNC_MUTEX_LOCK/80': 0.0000029409083289464782,
        THMUTEX: 0.0000014704541644732391,
        'SYNC_MUTEX_UNLOCK/81': 0.0000029409083289464782 },

    'hexacopter-hil-clean-02.kev.csv': {
      BUFFER: 0.0031467680009565706,
      TIME: 0.0031467680009565706,
      PROCCREATE_NAME: 0.00003645468027058122,
      THCREATE: 0.00009915673033598091,
      THREADY: 0.069670726745924,
      THRECEIVE: 0.06062704966439821,
      THSIGWAITINFO: 0.00013706959781738538,
      PROCTHREAD_NAME: 0.00003062193142728823,
      THNANOSLEEP: 0.002416216208334123,
      THREPLY: 0.026187584119174726,
      THRUNNING: 0.12252418038942348,
      THCONDVAR: 0.003148226188167394,
      THJOIN: 0.0000014581872108232487,
      'TRACE_EVENT/01': 0.0000014581872108232487,
      'MSG_SENDV/11': 0.05247286678147461,
      SND_MESSAGE: 0.026359650210051867,
      REC_MESSAGE: 0.026202165991282958,
      'MSG_RECEIVEV/14': 0.12304912778531985,
      'MSG_REPLYV/15': 0.05238829192324686,
      REPLY_MESSAGE: 0.026174460434277316,
      REC_PULSE: 0.03532604336940402,
      SND_PULSE_EXE: 0.07031232911868623,
      'EVENT-2': 0.03500815855744455,
      'EVENT-0': 0.004377478006891393,
      'CONNECT_CLIENT_INFO/42': 0.026266326228559178,
      'SYNC_CONDVAR_SIGNAL/83': 0.0031511425625890405,
      'SYNC_CONDVAR_SIG/83': 0.003154058937010687,
      'SYNC_CONDVAR_WAIT/82': 0.0062979105635456115,
      'MSG_READV/16': 0.02180864792507251,
      THWAITPAGE: 0.002655358910909136,
      'MSG_WRITEV/17': 0.010962651450969184,
      'TIMER_TIMEOUT/75': 0.0048295160422466,
      'SIGNAL_WAITINFO/32': 0.00025372457468324526,
      'EVENT-1': 0.0021887390034456963,
      'MSG_INFO/19': 0.0037912867481404468,
      'MSG_CURRENT/10': 0.0037912867481404468,
      'EVENT-3': 0.0021872808162348733,
      'MSG_DELIVER_EVENT/21': 0.0002508082002615988,
      'MSG_SENDVNC/12': 0.000281430131688887,
      THSEND: 0.000055411114011283455,
      'MSG_ERROR/13': 0.000017498246529878984,
      MSG_ERROR: 0.000008749123264939492,
      'CONNECT_ATTACH/39': 0.0004724526563067326,
      PATHMGR_OPEN: 0.0001137386024442134,
      'CONNECT_DETACH/40': 0.0004724526563067326,
      'CONNECT_FLAGS/43': 0.0002187280816234873,
      'SYNC_MUTEX_LOCK/80': 0.0000029163744216464975,
      THMUTEX: 0.0000014581872108232487,
      'SYNC_MUTEX_UNLOCK/81': 0.0000029163744216464975 },
    'hexacopter-hil-clean-03.kev.csv': {
      BUFFER: 0.0031147058612448777,
      TIME: 0.0031147058612448777,
      PROCCREATE_NAME: 0.000035883708078858034,
      THCREATE: 0.00009760368597449386,
      THREADY: 0.06847903314936953,
      THRECEIVE: 0.059598533074013735,
      THSIGWAITINFO: 0.00013635809069966053,
      PROCTHREAD_NAME: 0.00003014231478624075,
      THNANOSLEEP: 0.0023683247332046305,
      THREPLY: 0.025763067052296917,
      THRUNNING: 0.1200510984003043,
      THCONDVAR: 0.003116141209568032,
      THJOIN: 0.0000014353483231543215,
      'TRACE_EVENT/01': 0.0000014353483231543215,
      'MSG_SENDV/11': 0.05166823358858611,
      SND_MESSAGE: 0.02594105024436805,
      REC_MESSAGE: 0.025783161928821078,
      'MSG_RECEIVEV/14': 0.12091948413581266,
      'MSG_REPLYV/15': 0.05154192293614853,
      REPLY_MESSAGE: 0.025747278220742218,
      REC_PULSE: 0.03469667501560941,
      SND_PULSE_EXE: 0.08634624907599452,
      'EVENT-2': 0.03445410114899633,
      'EVENT-0': 0.004306044969462964,
      'CONNECT_CLIENT_INFO/42': 0.02578746797379054,
      'SYNC_CONDVAR_SIGNAL/83': 0.0031132705129217233,
      'SYNC_CONDVAR_SIG/83': 0.003116141209568032,
      'SYNC_CONDVAR_WAIT/82': 0.006245200554044453,
      'MSG_READV/16': 0.021560367162101062,
      THWAITPAGE: 0.002630993476341871,
      'MSG_WRITEV/17': 0.010749323592102714,
      'TIMER_TIMEOUT/75': 0.004733778769762952,
      'SIGNAL_WAITINFO/32': 0.000245444563259389,
      'EVENT-1': 0.002153022484731482,
      'MSG_INFO/19': 0.003714681460323384,
      'MSG_CURRENT/10': 0.003714681460323384,
      'EVENT-3': 0.002153022484731482,
      'MSG_DELIVER_EVENT/21': 0.000241138518289926,
      'MSG_SENDVNC/12': 0.0002468799115825433,
      THSEND: 0.000027271618139932107,
      'MSG_ERROR/13': 0.000022965573170469143,
      MSG_ERROR: 0.000011482786585234572,
      'CONNECT_ATTACH/39': 0.0004765356432872347,
      PATHMGR_OPEN: 0.00011339251752919139,
      'CONNECT_DETACH/40': 0.0004794063399335434,
      'CONNECT_FLAGS/43': 0.00021530224847314823,
      'SYNC_MUTEX_LOCK/80': 0,
      THMUTEX: 0,
      'SYNC_MUTEX_UNLOCK/81': 0 },
    'hexacopter-hil-clean-04.kev.csv': {
      BUFFER: 0.0030885242714401772,
      TIME: 0.0030885242714401772,
      PROCCREATE_NAME: 0.000034718123554858106,
      THCREATE: 0.00009443329606921405,
      THREADY: 0.06734899352159815,
      THRECEIVE: 0.058626412159675595,
      THSIGWAITINFO: 0.00012776269468187785,
      PROCTHREAD_NAME: 0.00002916322378608081,
      THNANOSLEEP: 0.0022941736045050238,
      THREPLY: 0.025144253803370435,
      THRUNNING: 0.11840129984654589,
      THCONDVAR: 0.0030899129963823714,
      THJOIN: 0.0000013887249421943244,
      'TRACE_EVENT/01': 0.0000013887249421943244,
      'MSG_SENDV/11': 0.050434323725671276,
      SND_MESSAGE: 0.02532201059597131,
      REC_MESSAGE: 0.02518452682669407,
      'MSG_RECEIVEV/14': 0.11936785240631315,
      'MSG_REPLYV/15': 0.050320448280411344,
      REPLY_MESSAGE: 0.02513314400383288,
      REC_PULSE: 0.03453897803731504,
      SND_PULSE_EXE: 0.1011741669386253,
      'EVENT-2': 0.03334328586208572,
      'EVENT-0': 0.004168952276467361,
      'CONNECT_CLIENT_INFO/42': 0.02528312629758987,
      'SYNC_CONDVAR_SIGNAL/83': 0.0030885242714401772,
      'SYNC_CONDVAR_SIG/83': 0.0030885242714401772,
      'SYNC_CONDVAR_WAIT/82': 0.006204823041724241,
      'MSG_READV/16': 0.021628002249734407,
      THWAITPAGE: 0.002609414166383135,
      'MSG_WRITEV/17': 0.010523757611948589,
      'TIMER_TIMEOUT/75': 0.004581403584299076,
      'SIGNAL_WAITINFO/32': 0.00023608324017303513,
      'EVENT-1': 0.0020844761382336806,
      'MSG_INFO/19': 0.0037634445933466187,
      'MSG_CURRENT/10': 0.0037648333182888133,
      'EVENT-3': 0.0020830874132914865,
      'MSG_DELIVER_EVENT/21': 0.00023330579028864648,
      'MSG_SENDVNC/12': 0.00023330579028864648,
      THSEND: 0.000049994097918995675,
      'MSG_ERROR/13': 0.000016664699306331892,
      MSG_ERROR: 0.000008332349653165946,
      'CONNECT_ATTACH/39': 0.00045411305609754406,
      PATHMGR_OPEN: 0.0001083205454911573,
      'CONNECT_DETACH/40': 0.00044994688127096105,
      'CONNECT_FLAGS/43': 0.00020830874132914863,
      'SYNC_MUTEX_LOCK/80': 0,
      THMUTEX: 0,
      'SYNC_MUTEX_UNLOCK/81': 0 },
    'hexacopter-hil-clean-05.kev.csv': {
      BUFFER: 0.0030592849023880707,
      TIME: 0.0030606494362428378,
      PROCCREATE_NAME: 0.00003411334636918009,
      THCREATE: 0.00009278830212416985,
      THREADY: 0.06675981884448544,
      THRECEIVE: 0.05767202337173587,
      THSIGWAITINFO: 0.00012553711463858275,
      PROCTHREAD_NAME: 0.000028655210950111277,
      THNANOSLEEP: 0.0022528453942206534,
      THREPLY: 0.024714437177543593,
      THRUNNING: 0.11741404460115358,
      THCONDVAR: 0.0030606494362428378,
      THJOIN: 0.0000013645338547672037,
      'TRACE_EVENT/01': 0.0000013645338547672037,
      'MSG_SENDV/11': 0.049542130665032866,
      SND_MESSAGE: 0.02488227484167996,
      REC_MESSAGE: 0.024744456922348473,
      'MSG_RECEIVEV/14': 0.11721618719221233,
      'MSG_REPLYV/15': 0.04944797782905393,
      REPLY_MESSAGE: 0.024702156372850687,
      REC_PULSE: 0.03390730175711024,
      SND_PULSE_EXE: 0.11572475168895179,
      'EVENT-2': 0.03274608344670336,
      'EVENT-0': 0.004093601564301611,
      'CONNECT_CLIENT_INFO/42': 0.024621648875419424,
      'SYNC_CONDVAR_SIGNAL/83': 0.0030606494362428378,
      'SYNC_CONDVAR_SIG/83': 0.0030606494362428378,
      'SYNC_CONDVAR_WAIT/82': 0.006143131414161951,
      'MSG_READV/16': 0.021376787368783012,
      THWAITPAGE: 0.002584427120929084,
      'MSG_WRITEV/17': 0.010218994038351588,
      'TIMER_TIMEOUT/75': 0.004498868119167471,
      'SIGNAL_WAITINFO/32': 0.00023879342458426066,
      'EVENT-1': 0.0020468007821508056,
      'MSG_INFO/19': 0.0036160147151330898,
      'MSG_CURRENT/10': 0.0036160147151330898,
      'EVENT-3': 0.0020468007821508056,
      'MSG_DELIVER_EVENT/21': 0.00023333528916519183,
      'MSG_SENDVNC/12': 0.0002619905001153031,
      THSEND: 0.00004230054949778331,
      'MSG_ERROR/13': 0.00001773894011197365,
      MSG_ERROR: 0.000008187203128603222,
      'CONNECT_ATTACH/39': 0.000442108968944574,
      PATHMGR_OPEN: 0.00010643364067184189,
      'CONNECT_DETACH/40': 0.000442108968944574,
      'CONNECT_FLAGS/43': 0.00020604461206984775,
      'SYNC_MUTEX_LOCK/80': 0.0000027290677095344074,
      THMUTEX: 0.0000013645338547672037,
      'SYNC_MUTEX_UNLOCK/81': 0.0000027290677095344074 },
    'hexacopter-hil-clean-06.kev.csv': {
      BUFFER: 0.0030319619889562508,
      TIME: 0.0030306102448684415,
      PROCCREATE_NAME: 0.0000337936021952324,
      THCREATE: 0.00009191859797103213,
      THREADY: 0.06504727724947112,
      THRECEIVE: 0.056556972633940945,
      THSIGWAITINFO: 0.00012571220016626452,
      PROCTHREAD_NAME: 0.000028386625843995215,
      THNANOSLEEP: 0.0022317294889731476,
      THREPLY: 0.02452063775286063,
      THRUNNING: 0.11564441020026088,
      THCONDVAR: 0.0030346654771318694,
      THJOIN: 0.000001351744087809296,
      'TRACE_EVENT/01': 0.000001351744087809296,
      'MSG_SENDV/11': 0.049107510966023914,
      SND_MESSAGE: 0.024665274370256222,
      REC_MESSAGE: 0.024530099961475295,
      'MSG_RECEIVEV/14': 0.11487932304656083,
      'MSG_REPLYV/15': 0.049066958643389634,
      REPLY_MESSAGE: 0.024508472056070346,
      REC_PULSE: 0.03292578249085883,
      SND_PULSE_EXE: 0.13020134228187918,
      'EVENT-2': 0.03244456159559872,
      'EVENT-0': 0.004055232263427888,
      'CONNECT_CLIENT_INFO/42': 0.024553079610968052,
      'SYNC_CONDVAR_SIGNAL/83': 0.0030400724534831065,
      'SYNC_CONDVAR_SIG/83': 0.0030481829180099623,
      'SYNC_CONDVAR_WAIT/82': 0.006084200139229641,
      'MSG_READV/16': 0.02113451881289834,
      THWAITPAGE: 0.0025602033023108066,
      'MSG_WRITEV/17': 0.01021513007157485,
      'TIMER_TIMEOUT/75': 0.004458052001595058,
      'SIGNAL_WAITINFO/32': 0.0002324999831031989,
      'EVENT-1': 0.002027616131713944,
      'MSG_INFO/19': 0.0036578195016119548,
      'MSG_CURRENT/10': 0.0036578195016119548,
      'EVENT-3': 0.002027616131713944,
      'MSG_DELIVER_EVENT/21': 0.0002297964949275803,
      'MSG_SENDVNC/12': 0.0002595348648593848,
      THSEND: 0.000037848834458660286,
      'MSG_ERROR/13': 0.00001622092905371155,
      MSG_ERROR: 0.000008110464526855775,
      'CONNECT_ATTACH/39': 0.0004406685726258305,
      PATHMGR_OPEN: 0.00010543603884912509,
      'CONNECT_DETACH/40': 0.00043931682853802116,
      'CONNECT_FLAGS/43': 0.0002027616131713944,
      'SYNC_MUTEX_LOCK/80': 0.000010813952702474368,
      THMUTEX: 0.0000067587204390464796,
      'SYNC_MUTEX_UNLOCK/81': 0.000013517440878092959 },
    'hexacopter-hil-clean-07.kev.csv': {
      BUFFER: 0.003006715972912995,
      TIME: 0.003006715972912995,
      PROCCREATE_NAME: 0.00003320136895884491,
      THCREATE: 0.00009030772356805816,
      THREADY: 0.0647187644840972,
      THRECEIVE: 0.0557079129486667,
      THSIGWAITINFO: 0.00012483714728525686,
      PROCTHREAD_NAME: 0.000027889149925429727,
      THNANOSLEEP: 0.002191290351283764,
      THREPLY: 0.024169268547280742,
      THRUNNING: 0.11274786481996225,
      THCONDVAR: 0.003008044027671349,
      THJOIN: 0.0000013280547583537964,
      'TRACE_EVENT/01': 0.0000013280547583537964,
      'MSG_SENDV/11': 0.048387675120620574,
      SND_MESSAGE: 0.024303402077874476,
      REC_MESSAGE: 0.024191845478172755,
      'MSG_RECEIVEV/14': 0.11310776765947614,
      'MSG_REPLYV/15': 0.04835712986117843,
      REPLY_MESSAGE: 0.024157316054455556,
      REC_PULSE: 0.032391255556249096,
      SND_PULSE_EXE: 0.14388012446529194,
      'EVENT-2': 0.03187331420049112,
      'EVENT-0': 0.00398416427506139,
      'CONNECT_CLIENT_INFO/42': 0.02419981380672288,
      'SYNC_CONDVAR_SIGNAL/83': 0.003006715972912995,
      'SYNC_CONDVAR_SIG/83': 0.0030093720824297026,
      'SYNC_CONDVAR_WAIT/82': 0.006030696657684589,
      'MSG_READV/16': 0.02101646655094883,
      THWAITPAGE: 0.002539240697972459,
      'MSG_WRITEV/17': 0.010037437863637994,
      'TIMER_TIMEOUT/75': 0.004375940428775759,
      'SIGNAL_WAITINFO/32': 0.00022975347319520678,
      'EVENT-1': 0.001992082137530695,
      'MSG_INFO/19': 0.003654806694989648,
      'MSG_CURRENT/10': 0.003654806694989648,
      'EVENT-3': 0.001992082137530695,
      'MSG_DELIVER_EVENT/21': 0.0002257693089201454,
      'MSG_SENDVNC/12': 0.00025498651360392893,
      THSEND: 0.00005445024509250565,
      'MSG_ERROR/13': 0.000015936657100245558,
      MSG_ERROR: 0.000007968328550122779,
      'CONNECT_ATTACH/39': 0.0004302897417066301,
      PATHMGR_OPEN: 0.00010358827115159613,
      'CONNECT_DETACH/40': 0.0004356019607400452,
      'CONNECT_FLAGS/43': 0.00019920821375306948,
      'SYNC_MUTEX_LOCK/80': 0,
      THMUTEX: 0,
      'SYNC_MUTEX_UNLOCK/81': 0 },
    'hexacopter-hil-clean-08.kev.csv': {
      BUFFER: 0.0029790784473220987,
      TIME: 0.0029790784473220987,
      PROCCREATE_NAME: 0.00003269401281082198,
      THCREATE: 0.00008892771484543579,
      THREADY: 0.06367355158984446,
      THRECEIVE: 0.05457807722587378,
      THSIGWAITINFO: 0.00012292948816869064,
      PROCTHREAD_NAME: 0.000027462970761090463,
      THNANOSLEEP: 0.0021591126060266836,
      THREPLY: 0.02378554820012921,
      THRUNNING: 0.11155851051308675,
      THCONDVAR: 0.0029803862078345315,
      THJOIN: 0.0000013077605124328793,
      'TRACE_EVENT/01': 0.0000013077605124328793,
      'MSG_SENDV/11': 0.047641715467929786,
      SND_MESSAGE: 0.02391370873034763,
      REC_MESSAGE: 0.02381824221294003,
      'MSG_RECEIVEV/14': 0.11136626971775912,
      'MSG_REPLYV/15': 0.04759202056845734,
      REPLY_MESSAGE: 0.023775086116029742,
      REC_PULSE: 0.03190543322182495,
      SND_PULSE_EXE: 0.15740205527642134,
      'EVENT-2': 0.03139671438248856,
      'EVENT-0': 0.003923281537298638,
      'CONNECT_CLIENT_INFO/42': 0.023677004077597277,
      'SYNC_CONDVAR_SIGNAL/83': 0.002986925010396696,
      'SYNC_CONDVAR_SIG/83': 0.002989540531421562,
      'SYNC_CONDVAR_WAIT/82': 0.005980388823355556,
      'MSG_READV/16': 0.020627306562603802,
      THWAITPAGE: 0.002521362267970591,
      'MSG_WRITEV/17': 0.009836974574520117,
      'TIMER_TIMEOUT/75': 0.004311686409491203,
      'SIGNAL_WAITINFO/32': 0.00022493480813845523,
      'EVENT-1': 0.001961640768649319,
      'MSG_INFO/19': 0.0034995671312703846,
      'MSG_CURRENT/10': 0.0034995671312703846,
      'EVENT-3': 0.0019629485291617517,
      'MSG_DELIVER_EVENT/21': 0.00022231928711358945,
      'MSG_SENDVNC/12': 0.0002197037660887237,
      THSEND: 0.000022231928711358946,
      'MSG_ERROR/13': 0.00001569312614919455,
      MSG_ERROR: 0.000007846563074597274,
      'CONNECT_ATTACH/39': 0.00042371440602825285,
      PATHMGR_OPEN: 0.00010200531996976457,
      'CONNECT_DETACH/40': 0.0004263299270531186,
      'CONNECT_FLAGS/43': 0.00019616407686493187,
      'SYNC_MUTEX_LOCK/80': 0.0000026155210248657585,
      THMUTEX: 0.0000013077605124328793,
      'SYNC_MUTEX_UNLOCK/81': 0.0000026155210248657585 },
    'hexacopter-hil-clean-10.kev.csv': {
      BUFFER: 0.002934310008781512,
      TIME: 0.002934310008781512,
      PROCCREATE_NAME: 0.0000314975312235027,
      THCREATE: 0.00008567328492792735,
      THREADY: 0.061410106675838745,
      THRECEIVE: 0.05318547132275772,
      THSIGWAITINFO: 0.00011843071740037016,
      PROCTHREAD_NAME: 0.00002645792622774227,
      THNANOSLEEP: 0.0020800969620001185,
      THREPLY: 0.0231040691030637,
      THRUNNING: 0.10768753945065786,
      THCONDVAR: 0.002935569910030452,
      THJOIN: 0.000001259901248940108,
      'TRACE_EVENT/01': 0.000001259901248940108,
      'MSG_SENDV/11': 0.04626231395983183,
      SND_MESSAGE: 0.023241398339198173,
      REC_MESSAGE: 0.02311540821430416,
      'MSG_RECEIVEV/14': 0.10829733165514487,
      'MSG_REPLYV/15': 0.04620057879863376,
      REPLY_MESSAGE: 0.02309272999182324,
      REC_PULSE: 0.031049006378880025,
      SND_PULSE_EXE: 0.18215022306551612,
      'EVENT-2': 0.030235110172064712,
      'EVENT-0': 0.003779703746820324,
      'CONNECT_CLIENT_INFO/42': 0.023003277003148494,
      'SYNC_CONDVAR_SIGNAL/83': 0.002939349613777272,
      'SYNC_CONDVAR_SIG/83': 0.0029431293175240926,
      'SYNC_CONDVAR_WAIT/82': 0.005890038338795005,
      'MSG_READV/16': 0.020349924972880625,
      THWAITPAGE: 0.002480745559163073,
      'MSG_WRITEV/17': 0.00956265047945542,
      'TIMER_TIMEOUT/75': 0.004167753331493877,
      'SIGNAL_WAITINFO/32': 0.0002154431135687585,
      'EVENT-1': 0.001889851873410162,
      'MSG_INFO/19': 0.0034874066570662193,
      'MSG_CURRENT/10': 0.0034874066570662193,
      'EVENT-3': 0.001889851873410162,
      'MSG_DELIVER_EVENT/21': 0.00021166340982193817,
      'MSG_SENDVNC/12': 0.00024190103979650074,
      THSEND: 0.000035277234970323026,
      'MSG_ERROR/13': 0.000015118814987281297,
      MSG_ERROR: 0.000007559407493640648,
      'CONNECT_ATTACH/39': 0.000408208004656595,
      PATHMGR_OPEN: 0.00009827229741732843,
      'CONNECT_DETACH/40': 0.000408208004656595,
      'CONNECT_FLAGS/43': 0.0001889851873410162,
      'SYNC_MUTEX_LOCK/80': 0.000005039604995760432,
      THMUTEX: 0.000002519802497880216,
      'SYNC_MUTEX_UNLOCK/81': 0.000005039604995760432 },
    'hexacopter-hil-fifo-ls-02.kev.csv': {
      BUFFER: 0.0030078741980068113,
      TIME: 0.0030072650699796734,
      PROCCREATE_NAME: 0.00004690285808961613,
      THCREATE: 0.00011329781304764417,
      THREADY: 0.058423296466874705,
      THRECEIVE: 0.05124350441100061,
      THSIGWAITINFO: 0.000040811577818237416,
      PROCTHREAD_NAME: 0.000013400816597033181,
      THNANOSLEEP: 0.0020454519151289737,
      THREPLY: 0.040771375368446314,
      THRUNNING: 0.10567518491604083,
      THCONDVAR: 0.0017079949880945927,
      THJOIN: 6.091280271378719e-7,
      'TRACE_EVENT/01': 6.091280271378719e-7,
      'MSG_SENDV/11': 0.054398787591574786,
      SND_MESSAGE: 0.040885891437548234,
      REC_MESSAGE: 0.04079513136150469,
      'MSG_RECEIVEV/14': 0.11608213725969138,
      'MSG_REPLYV/15': 0.07477777486749942,
      REPLY_MESSAGE: 0.03736147667252851,
      REC_PULSE: 0.01726817044133153,
      SND_PULSE_EXE: 0.11780901521662725,
      'EVENT-2': 0.014592271018114859,
      'EVENT-0': 0.0013236352029705955,
      'CONNECT_CLIENT_INFO/42': 0.016705945272283272,
      'SYNC_CONDVAR_SIGNAL/83': 0.0029493979074015756,
      'SYNC_CONDVAR_SIG/83': 0.002951834419510127,
      'SYNC_CONDVAR_WAIT/82': 0.003428172536731943,
      'MSG_READV/16': 0.013651168216186846,
      THWAITPAGE: 0.0014746989537007878,
      'MSG_WRITEV/17': 0.004849268224044598,
      'TIMER_TIMEOUT/75': 0.004229785020445382,
      'SIGNAL_WAITINFO/32': 0.00008405966774502632,
      'EVENT-1': 0.0006615130374717288,
      'MSG_INFO/19': 0.0012109465179500894,
      'MSG_CURRENT/10': 0.0011427241789106477,
      'EVENT-3': 0.0006688225737973833,
      'MSG_DELIVER_EVENT/21': 0.00008223228366361271,
      'MSG_SENDVNC/12': 0.027393096508417234,
      THSEND: 0.0004757289891946779,
      'MSG_ERROR/13': 0.006811878727482821,
      MSG_ERROR: 0.0034044165436735658,
      'CONNECT_ATTACH/39': 0.02082852375995239,
      PATHMGR_OPEN: 0.004000143754214405,
      'CONNECT_DETACH/40': 0.02194140066553328,
      'CONNECT_FLAGS/43': 0.0005969454665951144,
      'SYNC_MUTEX_LOCK/80': 0.00041664357056230434,
      THMUTEX: 0.00011817083726474715,
      'SYNC_MUTEX_UNLOCK/81': 0.0002363416745294943 },
    'hexacopter-hil-full-while.kev.csv': {
      BUFFER: 0.003080531765580505,
      TIME: 0.003079819668547315,
      PROCCREATE_NAME: 0.000019226619896133528,
      THCREATE: 0.000049846792323309145,
      THREADY: 0.05571447187679582,
      THRECEIVE: 0.046465043512689215,
      THSIGWAITINFO: 0.00004913469529011901,
      PROCTHREAD_NAME: 0.000014954037696992744,
      THNANOSLEEP: 0.0018030296880374107,
      THREPLY: 0.0318407067420635,
      THRUNNING: 0.10219162103904926,
      THCONDVAR: 0.0030812438626136953,
      THJOIN: 7.120970331901306e-7,
      'TRACE_EVENT/01': 7.120970331901306e-7,
      'MSG_SENDV/11': 0.06426390885727652,
      SND_MESSAGE: 0.032150468951501206,
      REC_MESSAGE: 0.03190337128098423,
      'MSG_RECEIVEV/14': 0.11972772257838943,
      'MSG_REPLYV/15': 0.06305476809491968,
      REPLY_MESSAGE: 0.031476113061070156,
      REC_PULSE: 0.02801532147976612,
      SND_PULSE_EXE: 0.12269218252755994,
      'EVENT-2': 0.017097449766895038,
      'EVENT-0': 0.0018286651812322555,
      'CONNECT_CLIENT_INFO/42': 0.020419382426726994,
      'SYNC_CONDVAR_SIGNAL/83': 0.0030869406388792163,
      'SYNC_CONDVAR_SIG/83': 0.0030912132210783572,
      'SYNC_CONDVAR_WAIT/82': 0.006183138539189904,
      'MSG_READV/16': 0.018842087498210855,
      THWAITPAGE: 0.0025955936859780263,
      'MSG_WRITEV/17': 0.008140693283429572,
      'TIMER_TIMEOUT/75': 0.003607483570141202,
      'SIGNAL_WAITINFO/32': 0.00009470890541428737,
      'EVENT-1': 0.0009143325906161277,
      'MSG_INFO/19': 0.0010225713396610275,
      'MSG_CURRENT/10': 0.0010225713396610275,
      'EVENT-3': 0.0010496310269222525,
      'MSG_DELIVER_EVENT/21': 0.00009399680838109724,
      'MSG_SENDVNC/12': 0.0001210564956423222,
      THSEND: 0.0003304130234002206,
      'MSG_ERROR/13': 0.0007263389738539332,
      MSG_ERROR: 0.0003624573898937765,
      'CONNECT_ATTACH/39': 0.00024780976755016545,
      PATHMGR_OPEN: 0.000059816150787970974,
      'CONNECT_DETACH/40': 0.00024923396161654574,
      'CONNECT_FLAGS/43': 0.00011535971937680116,
      'SYNC_MUTEX_LOCK/80': 0.000008545164398281567,
      THMUTEX: 0.0000042725821991407835,
      'SYNC_MUTEX_UNLOCK/81': 0.000008545164398281567 },
    'hexacopter-hil-fifo-ls-01.kev.csv': {
      BUFFER: 0.0030183211157259826,
      TIME: 0.0030176981392315088,
      PROCCREATE_NAME: 0.00004734621358001541,
      THCREATE: 0.00011587362797214299,
      THREADY: 0.058775963324127815,
      THRECEIVE: 0.05137936340523936,
      THSIGWAITINFO: 0.00004983811955791096,
      PROCTHREAD_NAME: 0.000013705482878425515,
      THNANOSLEEP: 0.002188516425086765,
      THREPLY: 0.04062055934567533,
      THRUNNING: 0.1062255910022259,
      THCONDVAR: 0.0016938730884744988,
      THJOIN: 6.22976494473887e-7,
      'TRACE_EVENT/01': 6.22976494473887e-7,
      'MSG_SENDV/11': 0.053489384792022414,
      SND_MESSAGE: 0.04072895725571379,
      REC_MESSAGE: 0.040638002687520595,
      'MSG_RECEIVEV/14': 0.11654208175071347,
      'MSG_REPLYV/15': 0.07417220440855546,
      REPLY_MESSAGE: 0.037052772961823376,
      REC_PULSE: 0.01763771051154469,
      SND_PULSE_EXE: 0.1129531141660494,
      'EVENT-2': 0.014912811324715907,
      'EVENT-0': 0.0014073039010165107,
      'CONNECT_CLIENT_INFO/42': 0.017215955424785868,
      'SYNC_CONDVAR_SIGNAL/83': 0.0029641221607067544,
      'SYNC_CONDVAR_SIG/83': 0.00296661406668465,
      'SYNC_CONDVAR_WAIT/82': 0.0034033205893108445,
      'MSG_READV/16': 0.013732270867687892,
      THWAITPAGE: 0.0014639947620136344,
      'MSG_WRITEV/17': 0.004915284541398969,
      'TIMER_TIMEOUT/75': 0.004523432326374893,
      'SIGNAL_WAITINFO/32': 0.00009718433313792637,
      'EVENT-1': 0.0007033404622610184,
      'MSG_INFO/19': 0.001296414085000159,
      'MSG_CURRENT/10': 0.0012266407176190835,
      'EVENT-3': 0.0006877660498991713,
      'MSG_DELIVER_EVENT/21': 0.00009220052118213528,
      'MSG_SENDVNC/12': 0.027979120319811212,
      THSEND: 0.0004933973836233185,
      'MSG_ERROR/13': 0.007123736214308898,
      MSG_ERROR: 0.0035603106659182642,
      'CONNECT_ATTACH/39': 0.02107716373753502,
      PATHMGR_OPEN: 0.004040002566663157,
      'CONNECT_DETACH/40': 0.02221222691046644,
      'CONNECT_FLAGS/43': 0.0005245462083470129,
      'SYNC_MUTEX_LOCK/80': 0.00040493472140802655,
      THMUTEX: 0.00011275874549977355,
      'SYNC_MUTEX_UNLOCK/81': 0.00022676344398849487 },
    'hexacopter-hil-fifo-ls-sporadic.kev.csv': {
      BUFFER: 0.0029731564834023275,
      TIME: 0.0029731564834023275,
      PROCCREATE_NAME: 0.00005006367473630524,
      THCREATE: 0.00012015281936713257,
      THREADY: 0.05740175786077918,
      THRECEIVE: 0.05042288160253823,
      THSIGWAITINFO: 0.00004693469506528616,
      PROCTHREAD_NAME: 0.00001376751055248394,
      THNANOSLEEP: 0.0023123159768830984,
      THREPLY: 0.04108037410080947,
      THRUNNING: 0.10441405162190662,
      THCONDVAR: 0.0015701219989173731,
      THJOIN: 6.257959342038155e-7,
      'TRACE_EVENT/01': 6.257959342038155e-7,
      'MSG_SENDV/11': 0.05272643643634247,
      SND_MESSAGE: 0.04118237883808469,
      REC_MESSAGE: 0.04109351581542775,
      'MSG_RECEIVEV/14': 0.11424029938077493,
      'MSG_REPLYV/15': 0.07465745495051519,
      REPLY_MESSAGE: 0.037314334168770905,
      REC_PULSE: 0.016039775589577993,
      SND_PULSE_EXE: 0.1264595907920386,
      'EVENT-2': 0.014957774419339598,
      'EVENT-0': 0.0014211825665768649,
      'CONNECT_CLIENT_INFO/42': 0.013571636425078146,
      'SYNC_CONDVAR_SIGNAL/83': 0.002916834849323984,
      'SYNC_CONDVAR_SIG/83': 0.002916834849323984,
      'SYNC_CONDVAR_WAIT/82': 0.0031465019571767843,
      'MSG_READV/16': 0.012211156064119051,
      THWAITPAGE: 0.00136298354469591,
      'MSG_WRITEV/17': 0.003500702455936144,
      'TIMER_TIMEOUT/75': 0.004778577753580335,
      'SIGNAL_WAITINFO/32': 0.00009762416573579522,
      'EVENT-1': 0.0007115299771897382,
      'MSG_INFO/19': 0.00042241225558757546,
      'MSG_CURRENT/10': 0.0003479425394173214,
      'EVENT-3': 0,
      'MSG_DELIVER_EVENT/21': 0.00009386939013057232,
      'MSG_SENDVNC/12': 0.0296214247496034,
      THSEND: 0.0005062689107708867,
      'MSG_ERROR/13': 0.0075201897413272505,
      MSG_ERROR: 0.003758530380828116,
      'CONNECT_ATTACH/39': 0.02289975062032022,
      PATHMGR_OPEN: 0.0044068549686632685,
      'CONNECT_DETACH/40': 0.024137574978175366,
      'CONNECT_FLAGS/43': 0.0006733564252033055,
      'SYNC_MUTEX_LOCK/80': 0.00044306352141630135,
      THMUTEX: 0.00012203020716974402,
      'SYNC_MUTEX_UNLOCK/81': 0.00024406041433948803 },
    'hexacopter-hil-half-while.kev.csv': {
      BUFFER: 0.003097076999594107,
      TIME: 0.003097076999594107,
      PROCCREATE_NAME: 0.000019294203735357844,
      THCREATE: 0.00005002200968426107,
      THREADY: 0.05627690469520875,
      THRECEIVE: 0.0470128285016836,
      THSIGWAITINFO: 0.000050736609822607664,
      PROCTHREAD_NAME: 0.000015006602905278323,
      THNANOSLEEP: 0.0018465267574875803,
      THREPLY: 0.03214986022421294,
      THRUNNING: 0.10303676474791766,
      THCONDVAR: 0.0030977915997324537,
      THJOIN: 7.146001383465868e-7,
      'TRACE_EVENT/01': 7.146001383465868e-7,
      'MSG_SENDV/11': 0.06491570576768063,
      SND_MESSAGE: 0.032461425884532054,
      REC_MESSAGE: 0.03220845743555736,
      'MSG_RECEIVEV/14': 0.12083602499385444,
      'MSG_REPLYV/15': 0.06379878575144492,
      REPLY_MESSAGE: 0.03184615516541564,
      REC_PULSE: 0.02824742886870223,
      SND_PULSE_EXE: 0.1145968511859504,
      'EVENT-2': 0.01715326172087147,
      'EVENT-0': 0.001869393961914671,
      'CONNECT_CLIENT_INFO/42': 0.02065122939807801,
      'SYNC_CONDVAR_SIGNAL/83': 0.0031035084008392264,
      'SYNC_CONDVAR_SIG/83': 0.003107796001669306,
      'SYNC_CONDVAR_WAIT/82': 0.006224167204998771,
      'MSG_READV/16': 0.01891975326286423,
      THWAITPAGE: 0.0026075759048266953,
      'MSG_WRITEV/17': 0.008296507606203873,
      'TIMER_TIMEOUT/75': 0.0036959119155285467,
      'SIGNAL_WAITINFO/32': 0.0000971856188151358,
      'EVENT-1': 0.0009346969809573355,
      'MSG_INFO/19': 0.0010604666053063347,
      'MSG_CURRENT/10': 0.0010611812054446815,
      'EVENT-3': 0.0010719002075198802,
      'MSG_DELIVER_EVENT/21': 0.00009647101867678922,
      'MSG_SENDVNC/12': 0.0001029024199219085,
      THSEND: 0.00033872046557628215,
      'MSG_ERROR/13': 0.0006038371169028658,
      MSG_ERROR: 0.00030156125838225965,
      'CONNECT_ATTACH/39': 0.0002501100484213054,
      PATHMGR_OPEN: 0.00006002641162111329,
      'CONNECT_DETACH/40': 0.0002486808481446122,
      'CONNECT_FLAGS/43': 0.00011576522241214706,
      'SYNC_MUTEX_LOCK/80': 0.0000014292002766931736,
      THMUTEX: 7.146001383465868e-7,
      'SYNC_MUTEX_UNLOCK/81': 0.0000014292002766931736
    }
  };

  var forTraining = [];
  traces.forEach(function (trace, i) {
    if (i === traces.length - 1) return;
    forTraining.push(trainingInputs[trace]);
  });
  var input = trainingInputs[traces[traces.length - 1]];

  runNetwork(forTraining, input);
};

runFromMemory();
